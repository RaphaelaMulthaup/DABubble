<div
  class="post-container w-full flex flex-col"
  [ngClass]="{ 'post-current-user': senderIsCurrentUser$ | async }"
>
  <div
    class="post flex w-full"
    [ngClass]="{ clicked: postClicked }"
    [ngClass]="{ editing: editingPost }"
  >
    <div class="profile-img">
      @if(senderPhotoUrl$ | async; as photoUrl) {
      <img
        class="profil-img"
        [src]="senderPhotoUrl$ | async"
        alt="Profilbild"
        (click)="openUserProfileOverlay()"
      />
      } @else {
      <img
        class="profil-img"
        src="/assets/img/no-avatar.svg"
        alt="Profilbild"
        (click)="openUserProfileOverlay()"
      />
      }
    </div>

    <div class="post-content flex flex-col">
      <div class="post-header flex">
        <h4>{{ senderName$ | async }}</h4>
        <span class="post-time">{{ createdAtTime$ | async }} Uhr</span>
      </div>

      @if((senderIsCurrentUser$ | async) && editingPost) {
      <app-edit-displayed-post [post]="post" (endEditingPost)="editingPost = false" class="w-full h-full" />
      } @else {
      <div (click)="openPostInteractionOverlay($event)" class="text">
        <p>{{ post.text }}</p>
      </div>
      } 
      
      @if (post.ansCounter){
      <!-- flex-row for desktop -->
      <div class="answers flex flex-col-reverse items-start">
        <button
          class="link w-full"
          (click)="
            postService.openAnswers(
              post.id!,
              currentType,
              currentConversationId
            )
          "
        >
          {{ post.ansCounter }}
          {{ post.ansCounter == 1 ? "Antwort" : "Antworten" }}
        </button>
        <span class="post-time w-full">
          Letzte Antwort @if
          (postService.isPostCreatedToday(post.ansLastCreatedAt)) {
          {{
            post
              .ansLastCreatedAt!.toDate()
              .getHours()
              .toString()
              .padStart(2, "0")
          }}:{{
            post
              .ansLastCreatedAt!.toDate()
              .getMinutes()
              .toString()
              .padStart(2, "0")
          }}
          Uhr } @else {
          {{
            post
              .ansLastCreatedAt!.toDate()
              .getDate()
              .toString()
              .padStart(2, "0")
          }}.
          {{
            post
              .ansLastCreatedAt!.toDate()
              .toLocaleString("de-DE", { month: "long" })
          }}
          }
        </span>
      </div>
      }
    </div>
  </div>

  <div class="interactions-container flex w-full">
    <div
      class="interactions flex"
      [class.fill-row]="((visibleReactions$ | async)?.length ?? 0) == 3"
      [style.gap]="(visibleReactions$ | async)?.length === 0 ? '0px' : null"
    >
      @for (reaction of (visibleReactions$ | async); track $index) {
      @if(allReactionsVisible || $index <= 4) {
      <div
        (mouseenter)="openReactedUsersOverlay($event, reaction)"
        (mouseleave)="overlayService.close()"
        (click)="toggleExistingReaction(reaction.emoji)"
        class="reaction flex place-items-center"
      >
        <img class="reaction-img" [src]="reaction.emoji" />
        <p>{{ reaction.users.length }}</p>
      </div>
      } }

      <div class="add-reaction flex justify-start">
        @if (((visibleReactions$ | async)?.length ?? 0) > 5) {
        <button
          (click)="allReactionsVisible = !allReactionsVisible"
          [class.minimize]="allReactionsVisible"
          class="toggle-reactions-btn relative"
        >
          @if (!allReactionsVisible) { +
          {{ ((visibleReactions$ | async)?.length ?? 0) - 5 }}
          }
        </button>
        }

        <button
          (click)="openEmojiPickerOverlay($event)"
          class="add-reaction-btn btn-tertiary relative"
        ></button>
      </div>
    </div>
  </div>
</div>
